// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Participant {
  id           String        @id @default(auto()) @map("_id") @db.ObjectId
  firstname    String
  lastname     String
  receipts     Receipt[]
  bonusPayouts BonusPayout[]
}

model Category {
  id        String     @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  // Mode can be 'PER_ITEM' or 'PER_CATEGORY'
  mode      String
  products  Product[]
  tierRules TierRule[]
}

model Product {
  id         String    @id @default(auto()) @map("_id") @db.ObjectId
  name       String
  price      Float
  category   Category  @relation(fields: [categoryId], references: [id])
  categoryId String    @db.ObjectId
  receipts   Receipt[]
}

model TierRule {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  category        Category @relation(fields: [categoryId], references: [id])
  categoryId      String   @db.ObjectId
  minQuantity     Int
  bonusPercentage Float
}

model Receipt {
  id            String      @id @default(auto()) @map("_id") @db.ObjectId
  participant   Participant @relation(fields: [participantId], references: [id])
  participantId String      @db.ObjectId
  product       Product     @relation(fields: [productId], references: [id])
  productId     String      @db.ObjectId
  date          DateTime    @default(now())
  price         Float
}

model BonusPayout {
  id            String      @id @default(auto()) @map("_id") @db.ObjectId
  participant   Participant @relation(fields: [participantId], references: [id])
  participantId String      @db.ObjectId
  amount        Float
  // Period could be a string like "2024-01"
  period        String
}

model Forecast {
  id           String @id @default(auto()) @map("_id") @db.ObjectId
  month        Int
  year         Int
  targetAmount Float
  // Threshold as a decimal percentage, e.g. 0.9 for 90%
  threshold    Float
}
